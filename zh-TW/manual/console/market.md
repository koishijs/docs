# 安裝和配置外掛

::: tip
本節將介紹「外掛市場」「外掛配置」和「依賴管理」頁面的使用方法。
:::

當你成功安裝並啟動 Koishi 後，控制檯介面會自動開啟。你可以使用控制檯管理你的外掛和配置。我們將以 [echo](../../plugins/common/echo.md) 外掛為例來演示外掛的安裝與配置。echo 外掛註冊了一個名為 `echo` 的指令，呼叫此指令可以將輸入原樣輸出給使用者。

## 安裝外掛

::: warning
Koishi 不對非官方外掛的安全性做任何保證。請不要隨意下載來源不明的外掛，因為它們可能導致 Koishi 無法執行，甚至更嚴重的後果。如果你下載外掛後遇到了問題，可以前往使用者群或論壇進行反饋。此外，部分外掛帶有「不安全」標識，安裝此類外掛將不會受到官方群內的支援。
:::

前往「外掛市場」頁面，你將在這裡看到所有可下載的外掛。在搜尋框中輸入 `echo`，找到我們想要的外掛，點選「新增」按鈕，然後在彈出的對話方塊中點選「安裝」。等待片刻，外掛就已經安裝成功了。

![select-version](/manual/console/select-version.light.webp) {.light-only}

![select-version](/manual/console/select-version.dark.webp) {.dark-only}

## 啟用和停用外掛

Koishi 不會自動啟用剛剛安裝的外掛，你需要手動配置並啟用。前往「外掛配置」頁面，左側欄中列出了已配置的各種外掛。其中<span class="light-only">黑色</span><span class="dark-only">白色</span>字型顯示的是正在執行的外掛，而灰色字型則對應尚未執行的外掛。

![plugins](/manual/console/plugins.light.webp) {.light-only}

![plugins](/manual/console/plugins.dark.webp) {.dark-only}

我們可以看到此時 echo 外掛的名字是灰色的，這表明它並未處於執行狀態。echo 外掛沒有可配置的專案，因此右側的詳情頁是空白的。我們可以直接點選右上角的「啟用外掛」按鈕，看到「啟用成功」的提示資訊，這表明 echo 外掛就已經處於執行狀態了。

要停用 echo 外掛同樣很簡單。點選右上角的「停用外掛」按鈕，外掛便會停止執行。停用外掛既不會刪除外掛的程式碼，也不會刪除外掛的配置，你可以隨時重新啟用它。

## 配置外掛

::: warning
在配置外掛的過程中，請大家記住這個原則：**如無必要，勿動配置**。Koishi 在設計上兼顧了擴充套件性和實用性，許多基礎功能是以預裝外掛的形式提供的。前面我們已經用到的「外掛市場」和「外掛配置」頁面本身就分別由預裝的 market 外掛和 config 外掛提供。正是因為所有的預裝外掛均已配置完善，通常情況下你不需要修改預裝外掛的配置。隨意改動外掛配置、刪除預裝外掛都可能導致 Koishi 無法正常執行。
:::

雖然 echo 外掛沒有需要配置的地方，但更復雜的外掛則通常會提供各種配置項，允許使用者控制外掛的行為。下圖展示了 novelai 外掛的配置介面。

![settings](/manual/console/settings.light.webp) {.light-only}

![settings](/manual/console/settings.dark.webp) {.dark-only}

在這個介面中，我們可以看到許多配置項。其中你需要注意：

- 必選但尚未填入的配置項會在左側呈現 <span style="font-weight: bold; color: var(--vp-c-red-light)">紅色</span> 的提示條，只有正確填寫配置才能啟動外掛。
- 已修改但未儲存的配置項會在左側呈現 <span style="font-weight: bold; color: var(--vp-c-brand)">紫色</span> 的提示條，點選「啟用外掛」或「儲存配置」按鈕後會儲存配置；如果你想撤銷這些改動，可以在配置名稱旁的小三角處撥出選單，選擇「撤銷更改」使該配置恢復到上次儲存時的狀態。

## 管理外掛

### 分組管理

Koishi 提供了外掛分組的機制，分組內可以新增外掛，方便同時管理多個外掛。

Koishi 在安裝時預先配置了一些分組，而新安裝的外掛會放置在外掛列表的底部，這表明它不屬於任何分組。外掛和分組都可以透過點選並拖拽的方式改變排列順序或在分組之間移動。相信你也發現了，分組是可以巢狀的。

建立新的分組同樣很簡單。點選「全域性配置」或任意分組名後，點選右上角的「建立分組」按鈕可以在此建立一個新的外掛分組。新分組的名字是隨機生成的，但你可以點選名字修改成你喜歡的名字。分組可以在左側欄中點選小三角來控制展開和收起。

此外，[過濾器](../usage/filter.md) 機制也可用於分組，便於控制一系列外掛的行為。

### 新增更多外掛

::: tip
通常情況下，一個外掛只能同時執行一份配置。請參考 [維護多份配置](../recipe/multiple.md) 章節。
:::

如果某個已安裝的外掛並未顯示在外掛列表中，你也可以手動新增它。在「全域性配置」或任意分組介面中，點選右上角的「新增外掛」將會彈出對話方塊。在對話方塊中點選要新增的外掛，即可建立一份未啟用的外掛配置。

![select-plugin](/manual/console/select-plugin.light.webp) {.light-only}

![select-plugin](/manual/console/select-plugin.dark.webp) {.dark-only}

### 刪除外掛或分組

::: warning
注意：此操作無法被撤銷，如果你想要恢復之前的配置，只能再次手動新增。請謹慎操作。
:::

在任何外掛的配置介面點選右上角的「刪除外掛」可刪除這份配置。與之類似，在分組的配置介面點選右上角的「刪除分組」可刪除這個分組。刪除分組時，分組內的所有外掛也會一併刪除。

## 更新和解除安裝外掛

前往「依賴管理」頁面，你可以在這裡看到依賴列表。依賴可能包括 Koishi 本體，各種外掛，以及支援外掛執行的軟體包等。

當依賴的狀態顯示為「可更新」時，點選其右側的「修改」按鈕，在彈出的視窗左上角選擇你需要的版本，點選右下角的「更新」按鈕即可完成更新。

你也可以批次更新多個外掛，透過依賴名右側的下拉選單選擇好所需更改的版本，點選右上角的「應用更改」按鈕即可。此外，右上角的「全部更新」按鈕可以一鍵更新所有依賴。

![dependencies](/manual/console/dependencies.light.webp) {.light-only}

![dependencies](/manual/console/dependencies.dark.webp) {.dark-only}
